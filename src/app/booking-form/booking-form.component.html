<div class="container py-5">
  <form [formGroup]="bookingForm">
    <h2 class="bk-header">Ваши данные</h2>
    <form *ngIf="user" formGroupName="user" class="row px-0 mx-0 border-bottom pb-1">
      <div class="col-sm-6 col-md-4 pl-0 pr-0 pr-sm-3">
        <div class="form-group"><label>Фамилия</label><input formControlName="surname" type="text" class="form-control" /></div>
      </div>
      <div class="col-sm-6 col-md-4 pl-0 pl-md-3 pr-0 pr-md-3">
        <div class="form-group"><label>Имя</label><input formControlName="name" type="text" class="form-control" /></div>
      </div>
      <div class="col-sm-6 col-md-4 pl-0 pl-md-3 pr-0 pr-sm-3 pr-md-0">
        <div class="form-group"><label>Отчество</label><input formControlName="middlename" type="text" class="form-control" /></div>
      </div>
      <div class="col-sm-6 col-md-4 pl-0 pr-0 pr-md-3">
        <div class="form-group"><label>Телефон</label><input formControlName="phone" type="text" class="form-control" /></div>
      </div>
      <div class="col-sm-12 col-md-8 col-lg-4 pl-0 pr-0 pl-md-3 pr-md-0 pr-lg-3">
        <div class="form-group"><label>Email</label><input formControlName="email" type="text" class="form-control" /></div>
      </div>
    </form>
    <div *ngIf="!user" class="border-bottom pb-3">
      <button class="btn btn-outline-primary" (click)="enter()">Войти в личный кабнет</button>
      <small class="text-muted d-block mt-1">Необходимо войти в личный кабинет или зарегистрироваться</small>
    </div>
    <h2 class="bk-header mt-3 mb-0">Данные заказа</h2>
    <form formGroupName="order">
      <div class="row car" *ngIf="car">
        <div class="col-md-8 car-info-img row p-0 px-sm-3">
          <div class="car-img col-sm-4 ">
            <img [src]="car.img" />
          </div>
          <div class="car-info col-sm-8">
            <h2 class="car-title">{{ car.name }}</h2>
            <div class="car-details">
              <span class="car-places"
                ><i class="fas fa-user"></i><b>{{ car.places }}</b> мест</span
              >
              <span class="driver-license"
                ><i class="fas fa-id-badge"></i>Категория <b>{{ car.license }}</b></span
              >
              <span class="car-kpp"><i class="fas fa-cogs"></i>{{ car.kpp }}</span>
            </div>
          </div>
        </div>

        <div class="car-actions col-md-4 text-right p-0 px-sm-3">
          <div class="price">
            <h2>{{ car.price }} ₽ <span>в сутки</span></h2>
            <span class="text-muted">итого: {{ car.price * 3 }} ₽ за 3 суток</span>
          </div>
        </div>
      </div>
      <div class="row" *ngIf="carDates">
        <div class="col-7 col-sm-9 col-md-9 col-xl-6">
          <div class="form-group mb-0" [ngClass]="{ 'ng-invalid': submitted }">
            <label class="d-block">Период аренды</label>
            <ngbd-datepicker-i18n
              #dp
              (dateSelect)="onDateSelection($event)"
              [dayTemplate]="t"
              [minDate]="this.searchService.minDate"
              [maxDate]="maxDate"
              [markDisabled]="isDisabled"
              outsideDays="hidden"
            >
            </ngbd-datepicker-i18n>

            <ng-template #t let-date let-focused="focused">
              <span
                class="custom-day"
                [class.focused]="focused"
                [class.range]="isRange(date)"
                [class.faded]="isHovered(date) || isInside(date)"
                [class.disabled]="isDisabled(date)"
                (mouseenter)="hoveredDate = date"
                (mouseleave)="hoveredDate = null"
              >
                {{ date.day }}
              </span>
            </ng-template>
            <small *ngIf="!this.period?.value?.fromDate" class="d-block mt-2 validation-message">Укажите период аренды</small>
          </div>
        </div>
        <div class="pt-sm-3 pt-md-0 col-sm-4 col-md-3 col-xl-3">
          <div class="form-group">
            <label>Время подачи</label>
            <ngb-timepicker [readonlyInputs]="true" formControlName="time" [hourStep]="hourStep" [minuteStep]="minuteStep"></ngb-timepicker>
          </div>
        </div>
        <div class="pt-3 pt-xl-0 col-sm-8 col-md-12 col-xl-3 d-flex flex-column justify-content-between">
          <div>
            <div class="form-group" *ngIf="this.places?.length">
              <label>Место подачи</label>
              <select formControlName="place" class="form-control">
                <option *ngFor="let place of places" [value]="place.id">{{ place.name }}</option>
              </select>
            </div>
          </div>
          <div class="text-right">
            <small class="text-muted mr-2"> К оплате {{ car?.price * periodDays }} ₽ </small>
            <button
              class="btn btn-primary"
              [title]="!user ? 'Необходимо войти или зарегистрироваться' : ''"
              [disabled]="!user"
              (click)="addOrder()"
            >
              Оформить заказ
            </button>
          </div>
        </div>
      </div>
    </form>
  </form>
</div>
